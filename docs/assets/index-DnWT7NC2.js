var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{p as s}from"./phaser-nUMyL2sp.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i=(e=>(e.gameEnd="game-end",e.uiSceneCreated="ui-scene-created",e.uiChange="ui-change",e))(i||{}),a=(e=>(e[e.WIN=0]="WIN",e[e.LOSE=1]="LOSE",e))(a||{});class h extends s.GameObjects.Sprite{constructor(e,s,a){var h,r;super(e,s,a,"character",0),t(this,"shield"),t(this,"cursorKeys"),t(this,"staminaRestoreEvent"),t(this,"breathing"),t(this,"MAX_STAMINA",100),t(this,"hearts",3),t(this,"oxygen",5),t(this,"takingDamage",!1),t(this,"lastCollision",-1),t(this,"stamina",this.MAX_STAMINA),t(this,"restoringStamina",!1),t(this,"maxSpeed",128),t(this,"maxDivingSpeed",256),t(this,"hasShield",!1),t(this,"isDiving",!1),e.add.existing(this),this.setupAnimations(),this.setupPhysics(),this.setupControls(),null==(r=null==(h=this.scene.game)?void 0:h.events)||r.on(i.uiSceneCreated,(()=>{this.scene.game.events.emit(i.uiChange,this)})),this.breathing=this.scene.time.addEvent({delay:15e3,callback:()=>{this.checkOxygen()},callbackScope:this,loop:!0}),this.shield=this.scene.add.image(this.x,this.y,"bubble").setScale(1.5).setOrigin(.5).setVisible(!1)}setupAnimations(){this.anims.create({key:"player-swim",frames:this.anims.generateFrameNumbers("character",{start:0,end:5}),repeat:-1,frameRate:8}),this.anims.create({key:"player-die",frames:this.anims.generateFrameNumbers("character",{start:6,end:11}),frameRate:6}),this.play("player-swim")}setupPhysics(){this.scene.physics.world.enable(this),this.body.setCollideWorldBounds(),this.body.useDamping=!0,this.body.setDrag(.01,.01),this.body.setMaxSpeed(128),this.body.setSize(14,14)}setupControls(){this.cursorKeys=this.scene.input.keyboard.createCursorKeys(),this.cursorKeys.space.onDown=()=>{this.hearts<=0||this.stamina<=0||0===this.body.acceleration.x&&0==this.body.acceleration.y||(this.isDiving=!0,this.body.setMaxSpeed(this.maxDivingSpeed),this.body.velocity.scale(3))},this.cursorKeys.space.onUp=()=>{this.isDiving=!1,this.body.setMaxSpeed(this.maxSpeed)}}startStaminaTimer(){this.restoringStamina=!0,this.staminaRestoreEvent=this.scene.time.delayedCall(3e3,(()=>{this.restoreStamina()}))}restoreStamina(){const e=this.MAX_STAMINA/100;this.staminaRestoreEvent=this.scene.time.addEvent({delay:50,callback:()=>{this.stamina+=e,this.stamina>=this.MAX_STAMINA&&(this.stamina=this.MAX_STAMINA,this.resetStaminaTimer()),this.scene.game.events.emit(i.uiChange,this)},callbackScope:this,loop:!0})}resetStaminaTimer(){this.staminaRestoreEvent&&this.staminaRestoreEvent.remove(),this.restoringStamina=!1}takeDamage(e=1){if(this.hasShield){this.takingDamage=!0;const e=this.scene.add.text(this.x,this.y,"Blocked!",{fontSize:12}).setOrigin(.5).setSize(12,12).setScale(.5);return this.scene.time.delayedCall(500,(()=>{e.destroy()})),this.hasShield=!1,this.shield.setVisible(!1),void this.scene.time.delayedCall(1e3,(()=>{this.takingDamage=!1}))}if(this.hearts-=e,this.takingDamage=!0,this.scene.game.events.emit(i.uiChange,this),this.scene.sound.add("hitHurt").play(),this.tint=16711680,this.scene.time.delayedCall(100,(()=>this.clearTint())),this.hearts<=0)return this.play("player-die"),this.resetFlip(),this.angle=90,void this.scene.tweens.add({targets:this,angle:0,duration:500,onComplete:()=>{var e;this.body.setGravityY(-80),null==(e=this.scene)||e.game.events.emit(i.gameEnd,a.LOSE)}});this.scene.time.delayedCall(1e3,(()=>{this.takingDamage=!1}))}checkOxygen(){this.hasShield||(this.oxygen--,console.log(this.oxygen),this.scene.game.events.emit(i.uiChange,this),0===this.oxygen&&this.takeDamage(this.hearts))}preUpdate(e,t){if(super.preUpdate(e,t),this.body.setAcceleration(0,0),!(this.hearts<=0)){if(this.cursorKeys.left.isDown&&this.body.setAccelerationX(-320),this.cursorKeys.right.isDown&&this.body.setAccelerationX(320),this.cursorKeys.up.isDown&&this.body.setAccelerationY(-320),this.cursorKeys.down.isDown&&this.body.setAccelerationY(320),this.hasShield&&this.shield.setPosition(this.x,this.y),0!==this.body.acceleration.x||0!==this.body.acceleration.y){const t=e-this.lastCollision<100?this.body.acceleration:this.body.velocity;this.setFlipY(t.x<0),this.rotation=t.angle()}this.isDiving?(this.stamina-=30*this.scene.game.loop.delta/1e3,this.scene.game.events.emit(i.uiChange,this),this.stamina<=0&&(this.stamina=0,this.body.setMaxSpeed(this.maxSpeed)),this.resetStaminaTimer()):this.stamina==this.MAX_STAMINA||this.restoringStamina||this.startStaminaTimer()}}}class r extends s.GameObjects.Sprite{constructor(e,s,i,a){super(e,s,i,"fish",0),t(this,"patrolChain"),e.add.existing(this),this.setupAnimations(),this.setupPhysics(),this.setupPatrol(a)}static fromTileObject(e,t){const s=(t.properties||[]).reduce(((e,t)=>({...e,[t.name]:t.value})),{});return new r(e,t.x,t.y,s)}setupAnimations(){this.anims.create({key:"fish-swim",frames:this.anims.generateFrameNumbers("fish",{start:0,end:3}),repeat:-1,frameRate:6}),this.anims.create({key:"fish-attack",frames:this.anims.generateFrameNumbers("fish",{start:10,end:13}),frameRate:8}),this.play("fish-swim")}setupPhysics(){this.scene.physics.world.enable(this),this.body.useDamping=!0,this.body.setDrag(.01,.01),this.body.setMaxSpeed(150),this.body.setSize(30,30)}setupPatrol(e){const{patrolArea:t=100,movement:s="static"}=e||{},i=`+=${t}`,a=`-=${t}`,h={targets:this,x:i,duration:1e3,onStart:()=>{this.setFlipX(!1)}},r={targets:this,x:a,duration:1e3,onStart:()=>{this.setFlipX(!0)}},n={targets:this,y:a,duration:1e3},o={targets:this,y:i,duration:1e3},l={targets:this,angle:"-=90",duration:400},d={targets:this,angle:"+=90",duration:400},c={static:[{y:"-=5",targets:this,duration:1e3,yoyo:!0,loop:-1}],horizontal:[{delay:700,...h},{delay:700,...r}],vertical:[d,o,l,l,{delay:700,...n},d],mixed:[{delay:700,...h},{delay:700,...r},l,o,d,d,{delay:700,...n},l,r,{delay:700,...h},l,{delay:700,...n},d,d,{delay:700,...o},l]};this.patrolChain=this.scene.tweens.chain({targets:this,tweens:c[s],delay:0,loop:-1,repeatDelay:0,paused:!1,persist:!0})}attack(){this.play("fish-attack",!0),this.patrolChain.pause();const e=this.anims.currentAnim.duration;this.scene.time.delayedCall(e,(()=>{this.play("fish-swim"),this.patrolChain.resume()}))}}class n extends s.GameObjects.Text{constructor(e,t,s,i){super(e,t,s,i,{fontFamily:"Georgia",fontSize:"calc(100vw / 25)",color:"#fff",stroke:"#000",strokeThickness:4}),this.setOrigin(0,0),e.add.existing(this)}static showPowerupText(e,t,s,i){const a=e.add.text(t,s,i,{fontSize:12}).setOrigin(.5).setSize(12,12).setScale(.5);return e.tweens.add({targets:a,y:"-=30",duration:1e3,alpha:0,onComplete:()=>a.destroy()}),a}}const o=["oxygen","random","health","stamina","shield","speed","size","pull-down"];class l extends s.GameObjects.Sprite{constructor(e,s,i,a){super(e,s,i,"powerup"),t(this,"iconFrame"),t(this,"regenerationTime",3e4),t(this,"effectDuration",7500),t(this,"randomizing",!1),t(this,"effect"),this.iconFrame=e.add.image(this.x,this.y,"powerup-frame").setOrigin(.5),e.add.existing(this).setOrigin(.5),this.setScale(.5),this.iconFrame.setScale(.5),this.createAnimation(),this.setEffect(a)}static createOxygen(e,t,s){const i=new l(e,t,s,"oxygen");return i.iconFrame.destroy(),i.setTexture("bubble"),i}createAnimation(){this.anims.create({key:"random",frames:this.anims.generateFrameNumbers("powerup",{start:0,end:7}),repeat:-1,frameRate:8})}use(e){this.active&&!this.randomizing&&(this.applyEffect(e),this.randomizing||(this.scene.sound.add("powerUp").play(),this.remove()))}remove(){this.setActive(!1),this.setVisible(!1),this.iconFrame.setVisible(!1),this.scene.time.delayedCall(this.regenerationTime,(()=>{const e=Math.floor(Math.random()*o.length);this.effect=o[e],this.setFrame(e),this.setActive(!0),this.setVisible(!0),this.iconFrame.setVisible(!0)}))}setEffect(e){this.effect=e,this.setFrame(o.indexOf(e))}applyEffect(e){({oxygen:()=>{e.oxygen++,n.showPowerupText(this.scene,e.x,e.y,"+1 oxygen")},random:()=>{this.randomizing=!0,this.play("random"),this.scene.time.delayedCall(2e3,(()=>{if(this.anims.stop(),Math.random()<.8){const e=Math.floor(Math.random()*o.length);return this.effect=o[e],this.setFrame(e),void this.scene.time.delayedCall(500,(()=>{this.randomizing=!1}))}this.remove(),this.randomizing=!1,this.setFrame(o.indexOf("random"));const e=this.scene.add.text(this.x,this.y,"Nope!",{fontSize:12}).setOrigin(.5).setSize(12,12).setScale(.5);e.angle=-10,this.scene.tweens.add({targets:e,angle:10,duration:100,yoyo:!0,loop:1,onComplete:()=>e.destroy()})}))},health:()=>{e.hearts++,n.showPowerupText(this.scene,e.x,e.y,"+1 heart")},stamina:()=>{e.MAX_STAMINA+=20,e.stamina=e.MAX_STAMINA,n.showPowerupText(this.scene,e.x,e.y,"Stamina improved!")},shield:()=>{e.hasShield=!0,e.shield.setVisible(!0),e.shield.setPosition(e.x,e.y),n.showPowerupText(this.scene,e.x,e.y,"Shield acquired!")},speed:()=>{e.maxSpeed+=16,e.maxDivingSpeed+=24,n.showPowerupText(this.scene,e.x,e.y,"Speed improved!")},size:()=>{e.setScale(1.5*e.scale),n.showPowerupText(this.scene,e.x,e.y,"${powerupMsg}"),this.scene.time.delayedCall(this.effectDuration,(()=>{e.setScale(e.scale/1.5)}))},"pull-down":()=>{e.body.setGravityY(250),n.showPowerupText(this.scene,e.x,e.y,"Gravity augmented!"),this.scene.time.delayedCall(this.effectDuration,(()=>{e.body.setGravityY(0),n.showPowerupText(this.scene,e.x,e.y,"Gravity restored!")}))}})[this.effect](),this.scene.game.events.emit(i.uiChange,e)}preUpdate(e,t){super.preUpdate(e,t),this.iconFrame.setPosition(this.x,this.y)}}class d extends s.Scene{constructor(){super("level-1-scene"),t(this,"map"),t(this,"player"),t(this,"win"),t(this,"fish"),t(this,"powerups"),t(this,"bgMusic")}createMap(){this.map=this.make.tilemap({key:"map"});const e=this.map.addTilesetImage("cave","cave-tiles"),t=this.map.addTilesetImage("grass","grass-tiles"),s=this.map.createLayer("background",t),i=this.map.createLayer("caves",e);if(i.setCollisionByProperty({collides:!0}),this.physics.world.setBounds(0,0,s.width,s.height),this.physics.config.debug){const e=this.add.graphics().setAlpha(.75);i.renderDebug(e,{tileColor:null,collidingTileColor:new Phaser.Display.Color(243,134,48,255),faceColor:new Phaser.Display.Color(40,39,37,255)})}}createFish(){var e;const t=(null==(e=this.map.getObjectLayer("enemy-positions"))?void 0:e.objects)??[];this.fish=t.map((e=>r.fromTileObject(this,e)))}createPowerups(){var e,t;const s=(null==(e=this.map.getObjectLayer("powerup-positions"))?void 0:e.objects)??[];this.powerups=s.map((e=>new l(this,e.x,e.y-16,"random")));const i=(null==(t=this.map.getObjectLayer("oxygen-positions"))?void 0:t.objects)??[];this.powerups=this.powerups.concat(...i.map((e=>l.createOxygen(this,e.x,e.y-16)))),this.physics.world.enable(this.powerups),this.tweens.add({targets:this.powerups,y:"+=8",duration:800,yoyo:!0,loop:-1})}createPlayer(){const[e]=this.map.filterObjects("player-position",(e=>"player"===e.name))??[],[t]=this.map.filterObjects("player-position",(e=>"Win"===e.name))??[];this.player=new h(this,(null==e?void 0:e.x)??150,(null==e?void 0:e.y)??500),this.win=new Phaser.Physics.Arcade.Body(this.physics.world),this.win.position=new Phaser.Math.Vector2(t.x,t.y),this.win.setSize(this.win.width,this.game.canvas.height),this.physics.add.collider(this.player,this.map.getLayer("caves").tilemapLayer,(()=>{this.player.lastCollision=this.game.getTime()})),this.physics.add.overlap(this.player,this.fish,((e,t)=>{!this.player.takingDamage&&t instanceof r&&(t.attack(),this.player.takeDamage())})),this.physics.add.overlap(this.player,this.powerups,((e,t)=>{t instanceof l&&t.use(this.player)})),this.physics.add.overlap(this.player,this.win,(e=>{this.game.events.emit(i.gameEnd,a.WIN),this.player.destroy()}))}create(){this.createMap(),this.createFish(),this.createPowerups(),this.createPlayer(),this.bgMusic=this.sound.add("etherealUplifting"),this.bgMusic.loop=!0,this.bgMusic.play(),this.cameras.main.setZoom(4).startFollow(this.player,!1,.15,.15,-64,0)}}class c extends s.Scene{constructor(){super("loading-scene")}preload(){this.load.spritesheet("character","assets/character.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("fish","assets/fish.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("powerup","assets/powerup.png",{frameWidth:32,frameHeight:32}),this.load.image("powerup-frame","assets/powerup-frame.png"),this.load.image("bubble","assets/bubble.png"),this.load.spritesheet("tiles_spr","assets/dungeon.png",{frameWidth:16,frameHeight:16}),this.load.image("grass-tiles","assets/grass.png"),this.load.image("cave-tiles","assets/cave.png"),this.load.image("staminabar","assets/energybar.png"),this.load.tilemapTiledJSON("map","assets/map1.json"),this.load.audio("hitHurt","assets/sounds/hitHurt.wav"),this.load.audio("bubblePop","assets/sounds/bubble-pop.mp3"),this.load.audio("coolHipHop","assets/sounds/cool-hip-hop-loop.mp3"),this.load.audio("etherealUplifting","assets/sounds/ethereal-uplifting-loop.mp3"),this.load.audio("happyRelaxing","assets/sounds/happy-relaxing-loop.mp3"),this.load.audio("ohNo","assets/sounds/oh-no.mp3"),this.load.audio("powerUp","assets/sounds/power-up-type-1.mp3"),this.load.audio("stoneEffect","assets/sounds/stone-effect.mp3")}create(){this.scene.start("level-1-scene"),this.scene.start("ui-scene")}}class m extends s.Scene{constructor(){super("ui-scene"),t(this,"gameEndPhrase"),t(this,"hearts",[]),t(this,"staminaBar"),t(this,"bubbles",[]),t(this,"maxHearts",3),t(this,"maxBubbles",5),t(this,"maxStamina",100),t(this,"gameEndHandler"),this.gameEndHandler=e=>{console.log("GAME OVER"),this.cameras.main.setBackgroundColor("rgba(0,0,0,0.3)"),this.gameEndPhrase=new n(this,this.game.scale.width/2,.4*this.game.scale.height,e===a.LOSE?"YOU DIED!\nCLICK TO RESTART":`YOU ARE ROCK!\nYour time: ${Math.round(this.game.loop.time/1e3)} s\nCLICK TO RESTART`).setAlign("center").setColor(e===a.LOSE?"#ff0000":"#ffffff"),e===a.LOSE&&this.sound.add("ohNo").play(),this.gameEndPhrase.setPosition(this.game.scale.width/2-this.gameEndPhrase.width/2,.4*this.game.scale.height),this.input.on("pointerdown",(()=>{window.location.reload()}))}}create(){var e;this.initListeners(),this.createStaminaBar(),null==(e=this.game)||e.events.emit(i.uiSceneCreated)}createHearts(){if(this.hearts.length!==this.maxHearts){this.hearts.map((e=>e.destroy())),this.hearts=[];for(let e=0;e<this.maxHearts;e++)this.hearts.push(this.add.sprite(20+32*(e+1),50,"tiles_spr",530).setScale(2))}}createBubbles(){if(this.bubbles.length!==this.maxBubbles){this.bubbles.map((e=>e.destroy())),this.bubbles=[];for(let e=0;e<this.maxBubbles;e++)this.bubbles.push(this.add.sprite(20+32*(e+1),100,"bubble").setScale(1))}}createStaminaBar(){this.staminaBar=this.add.sprite(40,140,"staminabar"),this.staminaBar.setScale(.5),this.staminaBar.displayWidth=2*this.maxStamina,this.staminaBar.setOrigin(0,0)}updateUI(e){this.maxHearts=e.hearts,this.maxBubbles=e.oxygen,this.createHearts(),this.createBubbles(),this.staminaBar.displayWidth=2*e.stamina}initListeners(){this.game.events.on(i.uiChange,this.updateUI,this),this.game.events.once(i.gameEnd,this.gameEndHandler,this)}}const p={type:Phaser.AUTO,width:1920,height:1080,parent:"game-container",physics:{default:"arcade",arcade:{tileBias:4}},pixelArt:!0,zoom:4,scale:{mode:Phaser.Scale.RESIZE},scene:[c,d,m]};new s.Game(p);
